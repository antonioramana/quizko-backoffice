import{r as d,W as R,j as s,Y as A,a as b}from"./app--oISFhqW.js";import{A as P}from"./AuthenticatedLayout-DSVi8vY8.js";import{T as M,I as T}from"./TextInput-DT_McUro.js";import{I as q}from"./InputLabel-Cb622Tc0.js";import{P as I}from"./PrimaryButton-D_GEZHxU.js";import{S as $,i as z}from"./react-select-animated.esm-EkDYVW2y.js";import"./Modal-CkYoBzAA.js";import"./transition-D3AYu_rU.js";import"./SecondaryButton-CeOpsOwd.js";const F=z();function K({auth:g,questions:l,subjectData:i}){var f;const[a,u]=d.useState([]),[c,p]=d.useState([]),[j,x]=d.useState(0),{data:h,setData:m,post:v,put:N,processing:w,errors:y}=R({subject:(i==null?void 0:i.subject)||"",questions:((f=i==null?void 0:i.questions)==null?void 0:f.map(e=>e.id))||[]});d.useEffect(()=>{i&&i.questions&&(p(i.questions),u(i.questions.map(e=>({value:e.id,label:e.question}))))},[i]);const S=e=>{u(e),m("questions",e.map(t=>t.value));let o=0;e.forEach(t=>{const r=l.find(n=>n.id===t.value);r&&(o+=r.point)}),x(o)},C=e=>{e.preventDefault(),i?N(route("subjects.update",i.id)):v(route("subjects.store"))},k=e=>{p(c.filter(t=>t.id!==e)),u(a.filter(t=>t.value!==e)),m("questions",h.questions.filter(t=>t!==e));let o=0;a.forEach(t=>{const r=l.find(n=>n.id===t.value);r&&r.id!==e&&(o+=r.point)}),x(o)},E=l.map(e=>({label:`${e.question} (${e.point} pts)`,value:e.id,point:e.point})),Q={control:(e,{isFocused:o})=>({...e,backgroundColor:"white",border:"1px solid #ced4da",borderRadius:"0.375rem",boxShadow:o?"0 0 0 0.2rem rgba(0,123,255,.25)":"none",":hover":{borderColor:"#80bdff"}}),option:(e,{data:o,isDisabled:t,isFocused:r,isSelected:n})=>({...e,backgroundColor:n?"#007bff":r?"#e9ecef":"white",color:n?"white":"black",cursor:t?"not-allowed":"default",padding:"6px 12px"}),multiValue:(e,{data:o})=>({...e,backgroundColor:"#f1f3f5",borderRadius:"0.25rem",padding:"3px 6px",margin:"2px"}),multiValueRemove:(e,{data:o})=>({...e,color:"#777",":hover":{backgroundColor:"#ddd",color:"#333",cursor:"pointer"}})};return s.jsxs(P,{user:g.user,children:[s.jsx(A,{title:i?"Modifier un sujet":"Ajouter un sujet"}),s.jsx(b,{className:"inline-flex items-center px-4 py-2 bg-purple-950 border border-purple-950 rounded-md font-semibold text-xs text-white uppercase tracking-widest shadow-sm hover:text-purple-950 hover:border-purple-950 hover:bg-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150 mb-6",href:route("subjects.index"),children:"Retour"}),s.jsx("div",{className:"",children:s.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6",children:s.jsx("div",{className:"p-4 sm:p-8 bg-gray-100 shadow sm:rounded-lg",children:s.jsxs("form",{className:"p-5",onSubmit:C,children:[s.jsx("fieldset",{className:"gap-2",children:s.jsxs("div",{className:"m-2",children:[s.jsx(q,{htmlFor:"subject",value:"Sujet"}),s.jsx(M,{id:"subject",name:"subject",placeholder:"Nom du sujet ...",value:h.subject,className:"mt-1 block w-full",autoComplete:"subject",isFocused:!0,onChange:e=>m("subject",e.target.value),required:!0}),s.jsx(T,{message:y.name,className:"mt-2"})]})}),s.jsxs("div",{className:"m-2",children:[s.jsx("h2",{className:"text-black mb-2",children:"Sélectionnez les questions :"}),s.jsx($,{options:E,value:a,onChange:S,isMulti:!0,placeholder:"Sélectionnez les questions...",styles:Q,components:F,classNamePrefix:"react-select"}),c.length>0&&s.jsxs("div",{className:"mt-4 border rounded p-2 bg-white",children:[" ",s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Questions existantes:"}),s.jsxs("ul",{className:"list-disc pl-5",children:[" ",c.map(e=>s.jsxs("li",{className:"mb-1 flex items-center justify-between",children:[s.jsx("span",{children:e.question}),s.jsx("button",{type:"button",onClick:()=>k(e.id),className:"text-red-500 hover:text-red-700",children:"Supprimer"})]},e.id))]})]}),s.jsxs("div",{className:"mt-4 border rounded p-2 bg-white",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Questions sélectionnées:"}),s.jsx("ul",{className:"list-disc pl-5",children:a.map((e,o)=>{var t;return s.jsxs("li",{className:"text-purple-500 mb-1 flex items-center justify-between",children:[s.jsxs("span",{children:[o+1+") "," ",e.label]})," ",s.jsxs("span",{children:[(t=l.find(r=>r.id===e.value))==null?void 0:t.point," pts"]})," "]},e.value)})}),s.jsxs("div",{className:"mt-2 font-medium",children:["Total des points: ",j]})," "]})]}),s.jsxs("div",{className:"flex items-center justify-end mt-4",children:[s.jsx(b,{href:route("subjects.index"),className:"inline-flex items-center justify-center rounded-md bg-white py-2 px-5 text-center font-medium border-purple-950 border text-purple-950 hover:bg-opacity-90 lg:px-8 xl:px-10 ",children:"Annuler"}),s.jsx(I,{className:"ml-4",type:"submit",disabled:w,children:i?"Modifier":"Ajouter"})]})]})})})})]})}export{K as default};
